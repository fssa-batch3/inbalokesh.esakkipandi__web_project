<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ONLY HOME FOOD</title>
  <link rel="stylesheet" href="../../assets/css/profile.css">
  <link rel="stylesheet" href="../../assets/css/header.css">
  <link rel="stylesheet" href="../../assets/css/footer.css">
  <link rel="icon" href="../../assets/Images/LOGO.png" type="image/x-icon">
</head>

<body>

  <section>
    <div class="side">
      <div class="pro">
        <h1>Profile</h1>
        <div class="pbox">
          <div class="imgb">
            <img src="../../assets/Images/img.jpg" alt="Profile image" height="250px" width="250px">
            <div class="button_row">
              <button type="button" onclick="btn()">Edit profile</button>
              <button type="button" onclick="delData()">Delete</button>
              <a href="../../index.html"><button type="submit" id="logout_user">Log Out</button></a>
            </div>

          </div>
          <div>
            <div class="sep">
              <label for="name">Name</label>
              <input type="text" id="user_name" placeholder="Your Name" disabled>
            </div>
            <div class="sep">
              <label for="num">Mobile No</label>
              <input type="tel" id="user_phonenumber" placeholder="Mobile No" disabled>
            </div>
            <div class="sep">
              <label for="email">Email</label>
              <input type="email" id="user_email" placeholder="Email" disabled>
            </div>
            <div class="sep">
              <label class="addr">Address</label>
              <textarea type="text" id="user_address" placeholder="Your address" disabled></textarea>
            </div>
            <!-- <div class="sep">
              <label>Password</label>
              <input type="Password" name="Pass" id="user_password" placeholder="Password" disabled>
            </div> -->
          </div>
        </div>
      </div>
    </div>

    <div class="history">
      <h2>
        My Orders
      </h2>
      <div class="overflowbox">
      </div>
    </div>
  </section>

  <footer>
    <div class="foot">
      <div class="footer">
        <img src="../../assets/Images/logo-facebook.svg" alt="facebook link">
        <img src="../../assets/Images/logo-instagram.svg" alt="instagram link">
        <img src="../../assets/Images/logo-twitter.svg" alt="twitter link">
        <img src="../../assets/Images/logo-whatsapp.svg" alt="whatsapp link">
      </div>
      <p>
        No.123, Rk Road, CLV Nagar, Uthandi, Chennai - 600 119.
      </p>
      <div class="phone">
        <div>
          <div>
            <img src="../../assets/Images/call-outline.svg" alt="call image" height="30px" width="30px">
          </div>
          <img src="../../assets/Images/person-circle-outline.svg" alt="mail image" height="30px" width="30px">
        </div>
        <div>
          <p>+918888888888</p>
          <p>ohfood@gmail.com</p>
        </div>
      </div>
    </div>
  </footer>

  <script src="../../assets/javascript/header.js"></script>
  <!-- <script src="../../assets/javascript/javascript.js"></script> -->

  <script>

    function btn() {
      window.location.href = "./Edit profile.html"
    }

    // let userId = JSON.parse(localStorage.getItem('userId'));

    let user_list = JSON.parse(localStorage.getItem('user_list'));

    function login_data(e) {
      return e.user_phonenumber == userId;
    }

    let user_data = user_list.find(login_data);

    document.getElementById("user_name").value = user_data["user_name"];
    document.getElementById("user_phonenumber").value = user_data["user_phonenumber"];
    document.getElementById("user_email").value = user_data["user_email"];
    document.getElementById("user_address").value = user_data["user_address"];
    // document.getElementById("user_password").value = user_data["user_password"];

    function delData(e) {
      if (confirm("Are you sure?")) {
        let userId = JSON.parse(localStorage.getItem("userId"));
        let user_list = JSON.parse(localStorage.getItem("user_list"));

        function login_data(e) {
          return e.user_phonenumber == userId;
        }
        user_data = user_list.find(login_data);

        const indexOfUser = user_list.indexOf(user_data);

        user_list.splice(indexOfUser, 1);

        localStorage.setItem('user_list', JSON.stringify(user_list));
        window.location.href = "../../index.html";
      };
    }

    let orderedItems = JSON.parse(localStorage.getItem("order_list"));


    let product_list = JSON.parse(localStorage.getItem("product_list"));

    if (orderedItems == null || orderedItems.length == 0) {
      document.querySelector(".history").setAttribute("style", "display:none")
    }
    else {

      // Order history loop//
      let div_obox;
      let div_item;
      let div_ihead;
      let h3;
      let h4;
      let p;
      let div_order;
      let div_item_list;
      let div_total;
      let div_ordered_by;
      let div_view_button;
      let a_view;
      let button;

      for (let i = 0; i < orderedItems.length; i++) {

        // <div class="obox">
        div_obox = document.createElement("div");
        div_obox.setAttribute("class", "obox");
        console.log(div_obox);

        // <div class="item">
        div_item = document.createElement("div");
        div_item.setAttribute("class", "item");
        div_obox.append(div_item);

        // <div class="ihead">
        div_ihead = document.createElement("div");
        div_ihead.setAttribute("class", "ihead");
        div_item.append(div_ihead);

        // <h3>
        h3 = document.createElement("h3");
        h3.innerText = "Order:#" + orderedItems[i]["order_id"];
        div_ihead.append(h3);

        // <h4>
        h4 = document.createElement("h4");
        if (orderedItems[i]["order_status"] == "Not Delivered") {
          h4.setAttribute("class", "ndel");
        }
        else if(orderedItems[i]["order_status"] == "Delivered"){
          h4.setAttribute("class", "del");
        } 
        else if(orderedItems[i]["order_status"] == "Cancelled") {
          h4.setAttribute("class", "cancel");
        }
        h4.innerText = orderedItems[i]["order_status"];
        div_ihead.append(h4);

        // <h3>
        h3 = document.createElement("h3");
        h3.innerText = "Items" + "(" + orderedItems[i]["ordered_items"].length + ")";
        div_item.append(h3);

        // <p>
        p = document.createElement("p");
        p.innerText = orderedItems[i]["ordered_time"];
        div_item.append(p);

        // <div class="order">
        div_order = document.createElement("div");
        div_order.setAttribute("class", "order");
        div_obox.append(div_order);

        // <div class="item_list">
        div_item_list = document.createElement("div");
        div_item_list.setAttribute("class", "item_list");
        div_order.append(div_item_list);

        const items = orderedItems[i]["ordered_items"];

        // Loop for food
        for (let j = 0; j < items.length; j++) {
          // function for filter products
          let foodItems = product_list.filter(product => items[j].product_id === product.product_id)
          // <h4> food list//
          h4 = document.createElement("h4");
          h4.innerText = foodItems[0]["product_name"] + "(" + items[j]["quantity_ordered"] + ")";
          div_item_list.append(h4);
        }

        // <div class="total">
        div_total = document.createElement("div");
        div_total.setAttribute("class", "total");
        div_order.append(div_total);

        // <h3> Total//
        h3 = document.createElement("h3");
        h3.innerText = "Total";
        div_total.append(h3);

        // <h4> price//
        h4 = document.createElement("h4");
        h4.innerText = "Rs. " + orderedItems[i]["total_price"];
        div_total.append(h4);

        // <div class="ordered_by">
        div_ordered_by = document.createElement("div");
        div_ordered_by.setAttribute("class", "order_by");
        div_order.append(div_ordered_by);

        // <h4> email//
        h4 = document.createElement("h4");
        h4.innerText = "Ordered by: " + orderedItems[i]["user_id"];
        div_ordered_by.append(h4);

        // <div class="view_button">
        div_view_button = document.createElement("div");
        div_view_button.setAttribute("class", "view_button");
        div_order.append(div_view_button);

        // <a class = view>
        a_view = document.createElement("a");
        a_view.setAttribute("class", "view");
        a_view.setAttribute("href", "./orderhistory.html?order_id=" + orderedItems[i]["order_id"]);
        div_view_button.append(a_view);

        // <button>
        button = document.createElement("button");
        button.setAttribute("type", "button");
        button.innerText = "View details";
        a_view.append(button);

        document.querySelector("div.overflowbox").prepend(div_obox);

      }
    }



  </script>

</body>

</html>