<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ONLY HOME FOOD</title>
  <link rel="stylesheet" href="../../assets/css/header.css">
  <link rel="stylesheet" href="../../assets/css/footer.css">
  <link rel="stylesheet" href="../../assets/css/order history.css">
  <link rel="icon" href="../../assets/Images/LOGO.png" type="image/x-icon">
</head>

<body>
  <header class="header">
    <div class="head">
      <a href="../../index.html"><img src="../../assets/Images/LOGO.png" alt="Logo" height="80px" width="100px"></a>
      <h1>ONLY HOME FOOD</h1>
      <a href="#" class="toggle-button">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
      </a>
    </div>
    <div class="head">
      <nav class="navbar">
        <a class="navigation__link" href="../../index.html">Home</a>
        <a class="navigation__link" href="../Menu/menu.html">Menu</a>
        <a class="navigation__link" href="../Info/about us.html">About Us</a>
        <a class="navigation__link" href="../Info/contact us.html">Contact Us</a>
      </nav>
      <div class="Profile">
        <a href="Login.html"><button>Login</button></a>
        <a href="../Cart/cart.html"><img src="../../assets/Images/cart-outline.svg" alt="Cart icon" height="30px"
            width="30px"></a>
        <a href="Profile.html"><img src="../../assets/Images/person-circle-outline.svg" alt="Profile icon" height="30px"
            width="30px"></a>
      </div>
    </div>
  </header>

  <section class="order_details">

  </section>

  <footer>
    <div class="foot">
      <div class="footer">
        <img src="../../assets/Images/logo-facebook.svg" alt="facebook link">
        <img src="../../assets/Images/logo-instagram.svg" alt="instagram link">
        <img src="../../assets/Images/logo-twitter.svg" alt="twitter link">
        <img src="../../assets/Images/logo-whatsapp.svg" alt="whatsapp link">
      </div>
      <p>
        No.123, Rk Road, CLV Nagar, Uthandi, Chennai - 600 119.
      </p>
      <div class="phone">
        <div>
          <div>
            <img src="../../assets/Images/call-outline.svg" alt="call image" height="30px" width="30px">
          </div>
          <img src="../../assets/Images/person-circle-outline.svg" alt="mail image" height="30px" width="30px">
        </div>
        <div>
          <p>+918888888888</p>
          <p>ohfood@gmail.com</p>
        </div>
      </div>
    </div>
  </footer>

  <script>


    let div_popup;
    let h3_order_num;
    let div_phead;
    let p;
    let div_order;
    let image;
    let div_name;
    let p_fname;
    let p_quantity;
    let div_dpara;
    let div_lpara;
    let div_spara;
    let p_impnote;
    let div_cbut;
    let a;
    let button;

    // const items = [
    //   {
    //     "name": "Mutton Biryani",
    //     "type": "Non-veg",
    //     "image": {
    //       "source": "../../assets/Images/Authentic-Hyderabadi-mutton-biryani-recipe.jpg",
    //       "alt": "Mutton Biryani image"
    //     },
    //     "quantity": 2,
    //     "price": {
    //       "currency": "Rs ",
    //       "rate": 179
    //     }
    //   },
    //   {
    //     "name": "Smabar Rice",
    //     "type": "Veg",
    //     "image": {
    //       "source": "../../assets/Images/Sambar-Rice-min-scaled.webp",
    //       "alt": "Sambar Rice image"
    //     },
    //     "quantity": 1,
    //     "price": {
    //       "currency": "Rs ",
    //       "rate": 39
    //     }
    //   }
    // ]

    let order_history = JSON.parse(localStorage.getItem("order_list"));

    
    const url = window.location.search
    const urlParams = new URLSearchParams(url)
    const order_id = urlParams.get("order_id")
    // console.log(order_id)

    

    let product_list = JSON.parse(localStorage.getItem("product_list"))
    // console.log(product_list)

    const orders = order_history.find(e=>e.order_id == order_id);
    // console.log(orders)

    const items = orders["ordered_items"];

    const foodData = product_list.filter(product =>
      items.some(id => id.product_id == product.product_id));
    // console.log(foodData)


    // <div class="popuup">
    div_popup = document.createElement("div");
    div_popup.setAttribute("class", "popup");
    console.log(div_popup)

    // <h3> order_num
    h3_order_num = document.createElement("h3")
    h3_order_num.innerText = "Order:#" + order_id;
    div_popup.append(h3_order_num)

    // <div class="phead">
    div_phead = document.createElement("div");
    div_phead.setAttribute("class", "phead");
    div_popup.append(div_phead)

    // <p>
    p = document.createElement("p");
    p.innerText = "Food Name";
    div_phead.append(p)

    p = document.createElement("p");
    p.setAttribute("class", "quan");
    p.innerText = "Quantity";
    div_phead.append(p)

    p = document.createElement("p");
    p.innerText = "Price";
    div_phead.append(p)

    // Order list //
    for (let i = 0; i < foodData.length; i++) {
      // <div class="order">
      div_order = document.createElement("div");
      div_order.setAttribute("class", "orderr");
      div_popup.append(div_order)

      image = document.createElement("img");
      image.setAttribute("src", foodData[i]["product_image"]);
      image.setAttribute("alt", foodData[i]["product_name"] + " image");
      div_order.append(image)

      div_name = document.createElement("div");
      div_name.setAttribute("class", "name");
      div_order.append(div_name)

      p_fname = document.createElement("p");
      p_fname.setAttribute("class", "fname");
      p_fname.innerText = foodData[i]["product_name"];
      div_name.append(p_fname)

      p_fname = document.createElement("p");
      p_fname.setAttribute("class", "fname");
      p_fname.innerText = foodData[i]["product_type"];
      div_name.append(p_fname)

      p = document.createElement("p");
      p.setAttribute("class", "quantity");
      p.innerText = items[i]["quantity_ordered"];
      div_order.append(p)

      p = document.createElement("p");
      p.innerText = "Rs. " + foodData[i]["product_price"] * items[i]["quantity_ordered"];
      div_order.append(p)
    }

    // <div class="dpara">
    div_dpara = document.createElement("div");
    div_dpara.setAttribute("class", "dpara");
    div_popup.append(div_dpara)

    // <div class="lpara">
    div_lpara = document.createElement("div");
    div_lpara.setAttribute("class", "lpara");
    div_dpara.append(div_lpara)

    // <p>
    p = document.createElement("p");
    p.innerText = "Ordered time";
    div_lpara.append(p)

    p = document.createElement("p");
    p.innerText = "Delivered time";
    div_lpara.append(p)

    p = document.createElement("p");
    p.innerText = "Total";
    div_lpara.append(p)

    p = document.createElement("p");
    p.innerText = "Payment";
    div_lpara.append(p)

    // <div class="spara">
    div_spara = document.createElement("div");
    div_spara.setAttribute("class", "spara");
    div_dpara.append(div_spara)

    // <p>
    p = document.createElement("p");
    p.innerText = orders["ordered_time"];
    div_spara.append(p)

    p = document.createElement("p");
    p.innerText = "Not Delivered";
    div_spara.append(p)

    p = document.createElement("p");
    p.innerText = "Rs." + orders["total_price"];
    div_spara.append(p)

    p = document.createElement("p");
    p.innerText = "COD";
    div_spara.append(p)

    // <p class="impnote">
    p = document.createElement("p");
    p.setAttribute("class", "impnote");
    p.innerText = "Note: You can only cancel your order on the same day of the placement.";
    div_popup.append(p)

    // <div class="cbut">
    div_cbut = document.createElement("div");
    div_cbut.setAttribute("class", "cbut");
    div_popup.append(div_cbut)

    // <button>
    button = document.createElement("button");
    button.setAttribute("onclick", "cancel()");
    button.setAttribute("style", "display:none");
    button.innerText = "Cancel order";
    div_cbut.append(button)

    // <button>
    button = document.createElement("button");
    button.setAttribute("onclick", "reOrder()");
    button.innerText = "Re-order";
    div_cbut.append(button)

    // <button>
    button = document.createElement("button");
    button.setAttribute("onclick", "btn()");
    button.setAttribute("type", "close");
    button.innerText = "Close";
    div_cbut.append(button)

    document.querySelector("section.order_details").append(div_popup)

    function btn() {
      window.location.href = "./Profile.html"
    }
    
    function cancel() {
      if(confirm("Are you sure to cancel the order")){
        const indexOfOrder = order_history.indexOf(orders);
        order_history.splice(indexOfOrder, 1);
        localStorage.setItem("order_list", JSON.stringify(order_history));
        location.href = "../Login and Order/Profile.html"
      }
    }

    function reOrder(){
      let cart_product = JSON.parse(localStorage.getItem("cart_product"));
      localStorage.setItem("cart_product", JSON.stringify(items));
      localStorage.setItem("food_count", parseInt(items.length))
    }

  </script>

</body>
</html>